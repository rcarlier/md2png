<!DOCTYPE html>
<html lang="fr">
    <head>
        <title>Markdown to PNG</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="https://atontour.eu/coleoptera/css/coleoptera-12.min.css" />
        <style>
            .flashing {
                animation: flashAnimation 1.5s infinite;
                font-size: 2em;
            }

            @keyframes flashAnimation {
                0% {
                    color: black;
                }
                50% {
                    color: #eee;
                }
                100% {
                    color: black;
                }
            }
            textarea {
                height: 80vh;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-4">
                    <h1>Markdown to PNG</h1>

                    <textarea id="markdownInput">
---
Authors: Richard Carlier
Url: https://linkedin.com/in/rcarlier/
Date: 2025-11-07
Title: NoSQL Graph
---

# YAML Front Matter

Ceci est un **exemple** de Markdown.</textarea
                    >
                </div>
                <div class="col-1">
                    <p><button id="generateButton" onclick="generateImage()">Go</button></p>
                    <p>
                        <button disabled id="downloadButton" onclick="downloadImage()">Down</button>
                    </p>
                </div>
                <div class="col-7">
                    <div id="result"></div>
                </div>
            </div>
        </div>

        <script>
            function downloadImage() {
                const img = document.querySelector("#result img");
                if (!img) return;

                const link = document.createElement("a");
                link.href = img.src;
                link.download = "markdown-image.png";
                link.click();
            }
            async function generateImage() {
                const markdownInput = document.getElementById("markdownInput");
                const generateButton = document.getElementById("generateButton");
                const downloadButton = document.getElementById("downloadButton");
                const resultDiv = document.getElementById("result");

                const markdownContent = markdownInput.value;
                const apiUrl = "/md2png";

                resultDiv.innerHTML = `<div class="flashing">Please wait... Generating image...</div>`;

                markdownInput.disabled = true;
                generateButton.disabled = true;
                downloadButton.disabled = true;
                try {
                    const response = await fetch(apiUrl, {
                        method: "POST",
                        headers: {
                            "Content-Type": "text/markdown",
                        },
                        body: markdownContent,
                    });

                    if (!response.ok) {
                        throw new Error(`Erreur HTTP : ${response.status}`);
                    }

                    const data = await response.json();
                    const imageSrc = `data:image/png;base64,${data.image}`;

                    resultDiv.innerHTML = `<img src="${imageSrc}" alt="Image générée">`;
                } catch (error) {
                    alert(`Erreur : ${error.message}`);
                } finally {
                    markdownInput.disabled = false;
                    generateButton.disabled = false;
                    downloadButton.disabled = false;
                }
            }
        </script>
    </body>
</html>
